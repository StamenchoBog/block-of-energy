---
import DashboardLayout from '../components/layouts/DashboardLayout.astro';
import ReportsContainer from '../components/reports/ReportsContainer.jsx';
import { fetchReportData } from '../lib/apiService';

// Get initial parameters from URL
const url = new URL(Astro.request.url);
const reportType = (url.searchParams.get('type') || 'daily').trim().toLowerCase();
const date = url.searchParams.get('date') || new Date().toISOString().split('T')[0];
const week = url.searchParams.get('week') || '';
const month = url.searchParams.get('month') || '1';
const year = url.searchParams.get('year') || new Date().getFullYear().toString();

// Fetch report data using the API service
const reportData = await fetchReportData({
    type: reportType,
    date,
    week,
    month,
    year
}) || [];

const reportTitle = reportType.charAt(0).toUpperCase() + reportType.slice(1) + ' Report';
---

<DashboardLayout title={reportTitle} activeNav="reports">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold mb-6">{reportTitle}</h1>

        <ReportsContainer
                client:load
                initialData={reportData}
                initialReportType={reportType}
                initialDate={date}
                initialWeek={week}
                initialMonth={month}
                initialYear={year}
        />
    </div>
</DashboardLayout>
